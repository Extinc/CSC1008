{% extends 'base/main.html' %} {% block content %}

<body>
  {% include 'base/navbar.html' %} {% if request.user.is_authenticated %}
  <!-- <form>
        {% csrf_token %}
        <button type="button" onclick="plot_route()">ROUTE BUTTON TEST</button>
    </form> -->
  <form action="" method="POST" id="test">
    {% csrf_token %}
    <label for="startinglocation">Enter starting location here</label>
    <input
      type="text"
      id="startinglocation"
      name="startinglocation"
      required
      minlength="4"
      maxlength="8"
      size="10"
    />

    <label for="endinglocation">Enter ending location here</label>
    <input
      type="text"
      id="endinglocation"
      name="endinglocation"
      required
      minlength="4"
      maxlength="8"
      size="10"
    />

    <label for="rideprice"> Price of ride is</label>
    <input
      type="text"
      id="price"
      name="rideprice"
      required
      minlength="4"
      maxlength="8"
      size="10"
    />
  </form>
  <form>
    <button type="button" onclick="getInfo()">Get Ride Information</button>
  </form>
  <div id="result"></div>
  <div class="col-4">
    <input type="text" />
  </div>
  <div id="map" style="width: 1500px; height: 750px"></div>
  <script>
    mapboxgl.accessToken = "{{ mapbox_key }}";
    var map = new mapboxgl.Map({
      container: "map",
      center: [103.84042953664608, 1.3593394625724913],
      zoom: 13, // starting zoom
      style: "mapbox://styles/exkingist/cl0s7xq5v001i14n5vioj61u5",
    });

    function plot_route() {
      $.post(
        "/plot_route/",
        {
          reply: false,
          csrfmiddlewaretoken: $('input[name="csrfmiddlewaretoken"]').val(),
        },
        function (data) {
          //{ #console.log(data['coordinates']); }
          map.addSource("route", {
            type: "geojson",
            data: {
              type: "Feature",
              properties: {},
              geometry: data,
            },
          });

          map.addLayer({
            id: "route",
            type: "line",
            source: "route",
            layout: {
              "line-join": "round",
              "line-cap": "round",
            },
            paint: {
              "line-color": "#ee2323",
              "line-width": 8,
            },
          });
        }
      );
    }

    function getInfo() {
      //document.getElementById("rideprice").value = price;
      $.ajax({
        type: "POST",
        url: "/getInfo/",
        data: {
          csrfmiddlewaretoken: "{{csrf_token}}",
          starting: $('input[name="startinglocation"]').val(),
          ending: $('input[name="endinglocation"]').val(),
          //price: $('input[name="rideprice"]').val(),
        },
        success: function (result) {
          //   $("#result").html("<h2>Received!</h2>");
          $("#price").val(result);
        },
      });
    }
  </script>

  {% endif %}
</body>
{% endblock content %}
